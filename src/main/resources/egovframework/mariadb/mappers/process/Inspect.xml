<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="apc.sl.process.inspect.service.impl.InspectMapper">

	<select id="selectInspectListToCnt" resultType="int">
		SELECT COUNT(*) FROM sm_inspection_data
		WHERE 1=1
		<if test="searchKeyword != ''">
			AND po_lotno LIKE CONCAT('%',#{searchKeyword},'%')
		</if>
		<if test="searchStDate != ''">
			AND id_test_time >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND id_test_time <![CDATA[<=]]>
			#{searchEdDate}
		</if>

	</select>

	<select id="selectInspectList" resultType="egovMap">
		SELECT * from sm_inspection_data
		where 1=1 
		<if test="searchKeyword != ''">
			AND po_lotno LIKE CONCAT('%',#{searchKeyword},'%')
		</if>
		<if test="searchStDate != ''">
			AND id_test_time >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND id_test_time <![CDATA[<=]]>
			#{searchEdDate}
		</if>
		ORDER BY id_id DESC
		OFFSET #{firstIndex} ROWS
		FETCH
		NEXT
		#{recordCountPerPage} ROWS ONLY
	</select>

	<select id="selectTiList" resultType="egovMap">
		SELECT ti_idx, ti_name
		FROM sm_analysis_info
		WHERE ti_state = '부적합' AND ti_idx NOT IN (
		SELECT ti_IDX
		FROM sm_incongruity
		)
	</select>

	<select id="selectBiList" resultType="egovMap">
		select bi_idx, bi_name FROM
		sm_bad_item
	</select>

	<select id="selectInfo" resultType="egovMap">
		SELECT az_idx, ti_name FROM
		sm_analysis_info WHERE ti_idx = #{tiIdx}
	</select>

	<select id="selectTiIdx" resultType="int">
		SELECT COUNT(*) FROM
		sm_analysis_info WHERE ti_idx= #{tiIdx}
	</select>

	<select id="selectInco" resultType="egovMap">
		SELECT in_idx, in_name,
		ti_idx,
		(SELECT
		a.ti_name
		FROM
		sm_incongruity b
		JOIN sm_analysis_info a ON
		a.ti_idx =
		b.ti_idx
		WHERE b.in_idx = #{inIdx}) AS ti_name,
		az_idx,
		bi_idx,
		in_note
		FROM sm_incongruity WHERE in_idx = #{inIdx}
	</select>
	
	<select id="detailInspec" resultType="egovMap">
	select * from sm_inspection_excel_history 
	where id_doc = #{idDoc}
	
	</select>

<!-- 	<insert id="registInspect"> -->
<!-- 		INSERT INTO sm_incongruity( -->
<!-- 		IN_IDX, -->
<!-- 		IN_NAME, -->
<!-- 		AZ_IDX, -->
<!-- 		TI_IDX, -->
<!-- 		IN_REG_DTE, -->
<!-- 		IN_REG_MEM, -->
<!-- 		BI_IDX, -->
<!-- 		IN_NOTE -->
<!-- 		) VALUES( -->
<!-- 		(SELECT -->
<!-- 		CONCAT('IN', LPAD((SELECT (SELECT REGEXP_REPLACE((SELECT -->
<!-- 		IFNULL(MAX(a.in_idx),0) -->
<!-- 		FROM sm_incongruity a),'[a-z]','')))+1,10,0))), -->
<!-- 		#{inName}, -->
<!-- 		#{azIdx}, -->
<!-- 		#{tiIdx}, -->
<!-- 		NOW(), -->
<!-- 		#{userId}, -->
<!-- 		#{biIdx}, -->
<!-- 		#{inNote} -->
<!-- 		) -->
<!-- 	</insert> -->

<!-- 	<update id="modifyInspect"> -->
<!-- 		UPDATE sm_incongruity SET -->
<!-- 		in_name = #{inName}, -->
<!-- 		bi_idx = -->
<!-- 		#{biIdx}, -->
<!-- 		in_note = #{inNote}, -->
<!-- 		in_edt_dte = now(), -->
<!-- 		in_edt_mem = #{userId} -->
<!-- 		WHERE in_idx = #{inIdx} -->
<!-- 	</update> -->

<!-- 	<delete id="deleteInspect"> -->

<!-- 		DELETE FROM sm_incongruity WHERE in_idx = #{inIdx} -->

<!-- 	</delete> -->

</mapper>
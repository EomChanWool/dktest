<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="apc.sl.basicInfo.item.service.impl.ItemMapper">
	<select id="selectItemListToCnt" resultType="int">
		SELECT COUNT(*) FROM sm_item
		WHERE 1=1
		<if test="searchCondition == '제품'">
			AND item_type = '제품'
		</if>
		<if test="searchCondition == '자재'">
			AND item_type = '자재'
		</if>
		<if test="searchKeyword != ''">
				AND item_name LIKE CONCAT ('%', #{searchKeyword}, '%')
		</if>
	</select>
	
	<select id="selectItemList" resultType="egovMap">
		SELECT
			item_cd,
			item_type,
			item_name,
			item_std,
			item_note
		FROM sm_item
		WHERE 1=1
		<if test="searchCondition == '제품'">
			AND item_type = '제품'
		</if>
		<if test="searchCondition == '자재'">
			AND item_type = '자재'
		</if>
		<if test="searchKeyword != ''">
				AND item_name LIKE CONCAT ('%', #{searchKeyword}, '%')
		</if>
		ORDER BY item_cd DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<insert id="registItem">
		INSERT INTO sm_item
			(
			item_cd,
			item_type,
			item_name,
			item_std,
			item_per_price,
			item_note
			)
		VALUES
			(
			<if test="itemType == '제품'">
				(SELECT CONCAT('PD', LPAD((SELECT (SELECT REGEXP_REPLACE((SELECT IFNULL(MAX(a.item_cd),0) FROM sm_item a WHERE item_type LIKE CONCAT('%제품%')),'[a-z]','')))+1,2,0))),
			</if>
			<if test="itemType == '자재' or itemType == '부자재'">
				(SELECT CONCAT('MT', LPAD((SELECT (SELECT REGEXP_REPLACE((SELECT IFNULL(MAX(a.item_cd),0) FROM sm_item a WHERE item_type LIKE CONCAT('%자재%')),'[a-z]','')))+1,2,0))),
			</if>
			#{itemType},
			#{itemName},
			#{itemStd},
			#{itemPerPrice},
			#{itemNote}
			)
	</insert>
	
	<select id="selectItemInfo" resultType="egovMap">
		SELECT
			item_cd,
			item_type,
			item_name,
			item_std,
			item_per_price,
			item_note
		FROM sm_item
		WHERE item_cd = #{itemCd}
	</select>
	
	<update id="modifyItem">
		UPDATE sm_item SET
			item_type = #{itemType},
			item_name = #{itemName},
			item_std = #{itemStd},
			item_per_price = #{itemPerPrice},
			item_note = #{itemNote}
		WHERE item_cd = #{itemCd}
	</update>
	
	<delete id="deleteItem">
		DELETE FROM sm_item WHERE item_cd = #{itemCd}
	</delete>
</mapper>
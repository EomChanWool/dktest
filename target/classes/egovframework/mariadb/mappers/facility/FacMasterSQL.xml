<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="apc.sl.facility.facMaster.service.impl.FacMasterMapper">
	<select id="selectFacMasterListToCnt" resultType="int">
		SELECT 
			COUNT(*) 
		FROM sm_equipment
		WHERE 1=1
		<if test="searchKeyword != ''">
			AND wo_name = #{searchKeyword}
		</if>
		<if test="searchStDate != ''">
			AND wo_itn_dte >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND wo_itn_dte <![CDATA[<=]]> #{searchEdDate}
		</if>
	</select>
	
	<select id="selectFacMasterList" resultType="egovMap">
		SELECT
			eq_id,
			eq_type,
			eq_name,
			eq_sensorid,
			eq_place,
			eq_op_state,
			eq_isuse,
			eq_reg_id,
			eq_reg_date,
			eq_edt_id,
			eq_edt_date
		FROM sm_equipment
		WHERE 1=1
		<if test="searchKeyword != ''">
			AND wo_name LIKE CONCAT('%',#{searchKeyword},'%')
		</if>
		<if test="searchStDate != ''">
			AND wo_itn_dte >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND wo_itn_dte <![CDATA[<=]]> #{searchEdDate}
		</if>
		ORDER BY eq_id DESC
		OFFSET #{firstIndex} ROWS
		FETCH NEXT #{recordCountPerPage} ROWS ONLY
	</select>
	
	<insert id="registFacMaster">
		DECLARE @str NVARCHAR(50)
		DECLARE @seq INT
		
		SET @str = 'EM000'
	
		INSERT INTO sm_equipment
			(
			eq_id,
			eq_type,
			eq_name,
			eq_sensorid,
			eq_place,
			eq_op_state,
			eq_isuse,
			eq_reg_id,
			eq_reg_date
			)
		VALUES
			(
			@str + CAST(NEXT VALUE FOR eq_seq AS NVARCHAR(50)),
			#{eqType},
			#{eqName},
			#{eqSensorid},
			#{eqPlace},
			#{eqOpState},
			#{eqIsuse},
			#{userId},
			GETDATE()
			)
	</insert>
	
	<select id="selectFacMasterInfo" resultType="egovMap">
		SELECT
			eq_id,
			eq_type,
			eq_name,
			eq_sensorid,
			eq_place,
			eq_op_state,
			eq_isuse,
			eq_reg_id,
			eq_reg_date,
			eq_edt_id,
			eq_edt_date
		FROM sm_equipment
		WHERE eq_id = #{eqId}
	</select>
	
	<update id="modifyFacMaster">
		UPDATE sm_equipment SET
			eq_id = #{eqId},
			eq_type = #{eqType},
			eq_name = #{eqName},
			eq_sensorid = #{eqSensorid},
			eq_place = #{eqPlace},
			eq_op_state = #{eqOpState},
			eq_isuse = #{eqIsuse},
			eq_edt_id = #{userId},
			eq_edt_date = GETDATE()
		WHERE eq_id = #{eqId}
	</update>
	
	<delete id="deleteFacMaster">
		DELETE FROM sm_equipment WHERE eq_id = #{eqId}
	</delete>
	
</mapper>